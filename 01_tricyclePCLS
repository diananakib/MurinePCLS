# tricycle_cellcycle_analysis.R
# Run cell cycle analysis using Tricycle (Zheng et al. 2022, https://doi.org/10.1186/s13059-021-02581-y) on a Seurat object

library(Seurat)
library(tricycle)
library(ggplot2)

# Optional: subsetted to specific cell types (e.g., myeloid) as well as full map
# seurat <- subset(seurat, subset = genlab_pub == "Myeloid")

# Convert to SingleCellExperiment
sce <- as.SingleCellExperiment(seurat)

# Map to cell cycle space
sce <- project_cycle_space(sce, g = "mouse")  # or "human" for human genes

# Extract Tricycle position (angle on cell cycle)
seurat$tricyclePosition <- sce$tricyclePosition

# Optional: Add Seurat PCA for dimensionality
seurat <- RunPCA(seurat)

# UMAP colored by Tricycle position
p <- DimPlot(seurat, reduction = "umap", group.by = "tricyclePosition", pt.size = 0.5) +
  labs(title = "Cell Cycle Position (Tricycle)") +
  theme_minimal()

# Or use continuous coloring
FeaturePlot(seurat, features = "tricyclePosition", cols = c("lightgrey", "darkred"))

# Save output
ggsave("plots/tricycle_umap.png", plot = p, width = 7, height = 5)

# Optional: circular plot
plot_cyclic_score(sce, color_by = "tricyclePosition")
ggsave("plots/tricycle_circular.png", width = 5, height = 5)
